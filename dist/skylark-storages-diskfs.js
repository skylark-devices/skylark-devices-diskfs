/**
 * skylark-storages-diskfs - The filer features enhancement for skylark utils.
 * @author Hudaokeji Co.,Ltd
 * @version v0.9.1
 * @link www.skylarkjs.org
 * @license MIT
 */
!function(e,t){var r=t.define,a=t.require,n="function"==typeof r&&r.amd,o=!n&&"undefined"!=typeof exports;if(!n&&!r){var i={};r=t.define=function(e,t,r){"function"==typeof r?(i[e]={factory:r,deps:t.map(function(t){return function(e,t){if("."!==e[0])return e;var r=t.split("/"),a=e.split("/");r.pop();for(var n=0;n<a.length;n++)"."!=a[n]&&(".."==a[n]?r.pop():r.push(a[n]));return r.join("/")}(t,e)}),resolved:!1,exports:null},a(e)):i[e]={factory:null,resolved:!0,exports:r}},a=t.require=function(e){if(!i.hasOwnProperty(e))throw new Error("Module "+e+" has not been defined");var r=i[e];if(!r.resolved){var n=[];r.deps.forEach(function(e){n.push(a(e))}),r.exports=r.factory.apply(t,n)||null,r.resolved=!0}return r.exports}}if(!r)throw new Error("The module utility (ex: requirejs or skylark-utils) is not loaded!");if(function(e,t){e("skylark-storages-diskfs/diskfs",["skylark-langx/skylark"],function(e){var t=function(){return t};return e.attach("storages.diskfs",t)}),e("skylark-storages-diskfs/download",["./diskfs"],function(e){return e.downlad=function(e,t){if(window.navigator.msSaveBlob)types.isString(e)&&(e=dataURItoBlob(e)),window.navigator.msSaveBlob(e,t);else{var r=document.createElement("a");e instanceof Blob&&(e=URL.createObjectURL(e)),r.href=e,r.setAttribute("download",t||"noname"),r.dispatchEvent(new CustomEvent("click"))}}}),e("skylark-storages-diskfs/read",["skylark-langx/Deferred","./diskfs"],function(e,t){return t.read=t.readFile=function(t,r){r=r||{};var a=new e,n=new FileReader;n.onload=function(e){a.resolve(e.target.result)},n.onerror=function(e){var t=e.target.error.code;2===t?alert("please don't open this page using protocol fill:///"):alert("error code: "+t)},r.asArrayBuffer?n.readAsArrayBuffer(t):r.asDataUrl?n.readAsDataURL(t):r.asText?n.readAsText(t):n.readAsArrayBuffer(t);return a.promise}}),e("skylark-storages-diskfs/select",["./diskfs"],function(e){var t,r=1/0;return e.select=function(e){var a=(e=e||{}).directory||!1,n=e.multiple||!1,o=e.picked;if(!t){var i=t=document.createElement("input");function s(e){for(var t=e.length;t--;)e[t].size>r&&e.splice(t,1);o(e)}i.type="file",i.style.position="fixed",i.style.left=0,i.style.top=0,i.style.opacity=.001,document.body.appendChild(i),i.onchange=function(e){var t=e.target.webkitEntries||e.target.entries;t&&t.length?webentry.all(t).then(function(e){s(e)}):s(Array.prototype.slice.call(e.target.files)),i.value=""}}t.multiple=n,t.webkitdirectory=a,t.click()}}),e("skylark-storages-diskfs/upload",["skylark-langx/types","skylark-langx/objects","skylark-langx/arrays","skylark-langx/Deferred","skylark-langx/Xhr","./diskfs"],function(e,t,r,a,n,o){return o.upload=function(r){var o=t.mixin({contentRange:null,paramName:void 0,singleFileUploads:!0,limitMultiFileUploads:void 0,limitMultiFileUploadSize:void 0,limitMultiFileUploadSizeOverhead:512,sequentialUploads:!1,limitConcurrentUploads:void 0,multipart:!0,maxChunkSize:void 0,uploadedBytes:void 0,recalculateProgress:!0,progressInterval:100,bitrateInterval:500,autoUpload:!0,messages:{uploadedBytes:"Uploaded bytes exceed file size"},i18n:function(e,r){return e=this.messages[e]||e.toString(),r&&t.each(r,function(t,r){e=e.replace("{"+t+"}",r)}),e},formData:function(e){return e.serializeArray()},add:function(e,t){if(e.isDefaultPrevented())return!1;(t.autoUpload||!1!==t.autoUpload&&$(this).fileupload("option","autoUpload"))&&t.process().done(function(){t.submit()})},processData:!1,contentType:!1,cache:!1},r),i=function(){var e=Blob.prototype.slice||Blob.prototype.webkitSlice||Blob.prototype.mozSlice;return e.apply(this,arguments)},s=function(e){return n.request(e.url,e)};function l(r){var a,n=r.files[0],o=r.multipart,i="array"===e.type(r.paramName)?r.paramName[0]:r.paramName;r.headers=t.mixin({},r.headers),r.contentRange&&(r.headers["Content-Range"]=r.contentRange),o?(a=new FormData,r.blob?a.append(i,r.blob,n.name):t.each(r.files,function(t,n){a.append("array"===e.type(r.paramName)&&r.paramName[t]||i,n,n.uploadName||n.name)}),r.data=a):(r.headers["Content-Disposition"]='attachment; filename="'+encodeURI(n.name)+'"',r.contentType=n.type||"application/octet-stream",r.data=r.blob||n),r.blob=null}function u(e,r){e.uploadedBytes=e.uploadedBytes||0;var n,o,u=e.files[0],d=u.size,c=e.uploadedBytes,p=e.maxChunkSize||d,f=i,y=new a,k=y.promise;return!(!f||!(c||p<d)||e.data)&&(!!r||(c>=d?(u.error=e.i18n("uploadedBytes"),this._getXHRPromise(!1,e.context,[null,"error",u.error])):(o=function(){var r=t.mixin({},e),a=r._progress.loaded;r.blob=f.call(u,c,c+p,u.type),r.chunkSize=r.blob.size,r.contentRange="bytes "+c+"-"+(c+r.chunkSize-1)+"/"+d,l(r),n=s(r).done(function(t,n,i){c=function(e){var t=e.getResponseHeader("Range"),r=t&&t.split("-"),a=r&&r.length>1&&parseInt(r[1],10);return a&&a+1}(i)||c+r.chunkSize,a+r.chunkSize-r._progress.loaded&&y.progress({lengthComputable:!0,loaded:c-r.uploadedBytes,total:c-r.uploadedBytes}),e.uploadedBytes=r.uploadedBytes=c,r.result=t,r.textStatus=n,r.jqXHR=i,c<d?o():y.resolveWith(r.context,[t,n,i])}).fail(function(e,t,a){r.jqXHR=e,r.textStatus=t,r.errorThrown=a,y.rejectWith(r.context,[e,t,a])})},k.abort=function(){return n.abort()},o(),k)))}d=o,d.type=d.type||"POST",u(d,!0)||d.data||l(d),o._bitrateTimer=new function(){this.timestamp=Date.now?Date.now():(new Date).getTime(),this.loaded=0,this.bitrate=0,this.getBitrate=function(e,t,r){var a=e-this.timestamp;return(!this.bitrate||!r||a>r)&&(this.bitrate=(t-this.loaded)*(1e3/a)*8,this.loaded=t,this.timestamp=e),this.bitrate}};var d;var c=u(o)||s(o);return c.options=o,c}}),e("skylark-storages-diskfs/webentry",["skylark-langx/arrays","skylark-langx/Deferred","./diskfs"],function(e,t,r){var a=Array.prototype.concat,n=function(){function r(e,r){var a=new t,o=function(e){a.reject(e)};if(r=r||"",e.isFile)e.file(function(e){e.relativePath=r,a.resolve(e)},o);else if(e.isDirectory){var i=e.createReader();i.readEntries(function(t){n(t,r+e.name+"/").then(function(e){a.resolve(e)}).catch(o)},o)}else a.resolve([]);return a.promise}function n(n,o){return t.all(e.map(n,function(e){return r(e,o)})).then(function(){return a.apply([],arguments)})}return{one:r,all:n}}();return r.webentry=n}),e("skylark-storages-diskfs/main",["./diskfs","./download","./read","./select","./upload","./webentry"],function(e){return e}),e("skylark-storages-diskfs",["skylark-storages-diskfs/main"],function(e){return e})}(r),!n){var s=a("skylark-langx/skylark");o?module.exports=s:t.skylarkjs=s}}(0,this);
//# sourceMappingURL=sourcemaps/skylark-storages-diskfs.js.map
