/**
 * skylark-utils-filer - The filer features enhancement for skylark utils.
 * @author Hudaokeji Co.,Ltd
 * @version v0.9.1
 * @link www.skylarkjs.org
 * @license MIT
 */
define(["skylark-langx/types","skylark-langx/objects","skylark-langx/arrays","skylark-langx/Xhr","./filer"],function(e,t,a,n,o){function i(a){function o(e){e.type=e.type||"POST",s(e,!0)||e.data||i(e)}function i(a){var n,o=a.files[0],i=a.multipart,r="array"===e.type(a.paramName)?a.paramName[0]:a.paramName;a.headers=t.mixin({},a.headers),a.contentRange&&(a.headers["Content-Range"]=a.contentRange),i?(n=new FormData,a.blob?n.append(r,a.blob,o.name):t.each(a.files,function(t,o){n.append("array"===e.type(a.paramName)&&a.paramName[t]||r,o,o.uploadName||o.name)}),a.data=n):(a.headers["Content-Disposition"]='attachment; filename="'+encodeURI(o.name)+'"',a.contentType=o.type||"application/octet-stream",a.data=a.blob||o),a.blob=null}function r(e){var t=e.getResponseHeader("Range"),a=t&&t.split("-"),n=a&&a.length>1&&parseInt(a[1],10);return n&&n+1}function l(){this.timestamp=Date.now?Date.now():(new Date).getTime(),this.loaded=0,this.bitrate=0,this.getBitrate=function(e,t,a){var n=e-this.timestamp;return(!this.bitrate||!a||n>a)&&(this.bitrate=(t-this.loaded)*(1e3/n)*8,this.loaded=t,this.timestamp=e),this.bitrate}}function s(e,a){e.uploadedBytes=e.uploadedBytes||0;var n,o,l=e.files[0],s=l.size,d=e.uploadedBytes,u=e.maxChunkSize||s,c=p,m=new Deferred,h=m.promise;return!(!c||!(d||u<s)||e.data)&&(!!a||(d>=s?(l.error=e.i18n("uploadedBytes"),this._getXHRPromise(!1,e.context,[null,"error",l.error])):(o=function(){var a=t.mixin({},e),p=a._progress.loaded;a.blob=c.call(l,d,d+u,l.type),a.chunkSize=a.blob.size,a.contentRange="bytes "+d+"-"+(d+a.chunkSize-1)+"/"+s,i(a),n=$.ajax(a).done(function(t,n,i){d=r(i)||d+a.chunkSize,p+a.chunkSize-a._progress.loaded&&m.progress({lengthComputable:!0,loaded:d-a.uploadedBytes,total:d-a.uploadedBytes}),e.uploadedBytes=a.uploadedBytes=d,a.result=t,a.textStatus=n,a.jqXHR=i,d<s?o():m.resolveWith(a.context,[t,n,i])}).fail(function(e,t,n){a.jqXHR=e,a.textStatus=t,a.errorThrown=n,m.rejectWith(a.context,[e,t,n])})},h.abort=function(){return n.abort()},o(),h)))}var d=t.mixin({contentRange:null,paramName:void 0,singleFileUploads:!0,limitMultiFileUploads:void 0,limitMultiFileUploadSize:void 0,limitMultiFileUploadSizeOverhead:512,sequentialUploads:!1,limitConcurrentUploads:void 0,multipart:!0,maxChunkSize:void 0,uploadedBytes:void 0,recalculateProgress:!0,progressInterval:100,bitrateInterval:500,autoUpload:!0,messages:{uploadedBytes:"Uploaded bytes exceed file size"},i18n:function(e,a){return e=this.messages[e]||e.toString(),a&&t.each(a,function(t,a){e=e.replace("{"+t+"}",a)}),e},formData:function(e){return e.serializeArray()},add:function(e,t){return!e.isDefaultPrevented()&&void((t.autoUpload||t.autoUpload!==!1&&$(this).fileupload("option","autoUpload"))&&t.process().done(function(){t.submit()}))},processData:!1,contentType:!1,cache:!1},a),p=function(){var e=Blob.prototype.slice||Blob.prototype.webkitSlice||Blob.prototype.mozSlice;return e.apply(this,arguments)},u=function(e){return n.request(e.url,e)};o(d),d._bitrateTimer=new l;var c=s(d)||u(d);return c.options=d,c}return o.upload=i});
//# sourceMappingURL=sourcemaps/upload.js.map
