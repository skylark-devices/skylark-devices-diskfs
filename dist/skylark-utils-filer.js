/**
 * skylark-utils-filer - The filer features enhancement for skylark utils.
 * @author Hudaokeji Co.,Ltd
 * @version v0.9.1
 * @link www.skylarkjs.org
 * @license MIT
 */
!function(e,t){function r(e,t){if("."!==e[0])return e;var r=t.split("/"),n=e.split("/");r.pop();for(var a=0;a<n.length;a++)"."!=n[a]&&(".."==n[a]?r.pop():r.push(n[a]));return r.join("/")}var n=t.define,a=t.require,i="function"==typeof n&&n.amd,o=!i&&"undefined"!=typeof exports;if(!i&&!n){var l={};n=t.define=function(e,t,n){"function"==typeof n?(l[e]={factory:n,deps:t.map(function(t){return r(t,e)}),exports:null},a(e)):l[e]=n},a=t.require=function(e){if(!l.hasOwnProperty(e))throw new Error("Module "+e+" has not been defined");var t=l[e];if(!t.exports){var r=[];t.deps.forEach(function(e){r.push(a(e))}),t.exports=t.factory.apply(window,r)}return t.exports}}if(!n)throw new Error("The module utility (ex: requirejs or skylark-utils) is not loaded!");if(e(n,a),!i){var s=a("skylark-langx/skylark");o?exports=s:t.skylarkjs=s}}(function(e,t){e("skylark-utils-filer/filer",["skylark-langx/skylark"],function(e){var t=function(){return t};return e.filer=t}),e("skylark-utils-filer/download",["./filer"],function(e){function t(e,t){if(window.navigator.msSaveBlob)types.isString(e)&&(e=dataURItoBlob(e)),window.navigator.msSaveBlob(e,t);else{var r=document.createElement("a");e instanceof Blob&&(e=URL.createObjectURL(e)),r.href=e,r.setAttribute("download",t||"noname"),r.dispatchEvent(new CustomEvent("click"))}}return e.downlad=t}),e("skylark-utils-filer/webentry",["skylark-langx/Deferred","./filer"],function(e,t){var r=function(){function t(t,n){var a=new e,i=function(e){a.reject(e)};if(n=n||"",t.isFile)t.file(function(e){e.relativePath=n,a.resolve(e)},i);else if(t.isDirectory){var o=t.createReader();o.readEntries(function(e){r(e,n+t.name+"/").then(function(e){a.resolve(e)})["catch"](i)},i)}else a.resolve([]);return a.promise}function r(r,n){return e.all(langx.map(r,function(e){return t(e,n)})).then(function(){return concat.apply([],arguments)})}return{one:t,all:r}}();return t.webentry=r}),e("skylark-utils-filer/dropzone",["skylark-langx/Deferred","skylark-utils-dom/eventer","./filer","./webentry"],function(e,t,r,n){function a(e,r){r=r||{};var a=r.hoverClass||"dropzone",i=r.dropped,o=0;return t.on(e,"dragenter",function(r){r.dataTransfer&&r.dataTransfer.types.indexOf("Files")>-1&&(t.stop(r),o++,styler.addClass(e,a))}),t.on(e,"dragover",function(e){e.dataTransfer&&e.dataTransfer.types.indexOf("Files")>-1&&t.stop(e)}),t.on(e,"dragleave",function(t){t.dataTransfer&&t.dataTransfer.types.indexOf("Files")>-1&&(o--,0==o&&styler.removeClass(e,a))}),t.on(e,"drop",function(r){if(r.dataTransfer&&r.dataTransfer.types.indexOf("Files")>-1&&(styler.removeClass(e,a),t.stop(r),i)){var o=r.dataTransfer.items;o&&o.length&&(o[0].webkitGetAsEntry||o[0].getAsEntry)?n.all(langx.map(o,function(e){return e.webkitGetAsEntry?e.webkitGetAsEntry():e.getAsEntry()})).then(i):i(r.dataTransfer.files)}}),this}return r.dropzone=a}),e("skylark-utils-filer/pastezone",["skylark-langx/objects","skylark-utils-dom/eventer","./filer"],function(e,t,r){function n(r,n){n=n||{};var a=(n.hoverClass||"pastezone",n.pasted);return t.on(r,"paste",function(t){var r=t.originalEvent&&t.originalEvent.clipboardData&&t.originalEvent.clipboardData.items,n=[];r&&r.length&&e.each(r,function(e,t){var r=t.getAsFile&&t.getAsFile();r&&n.push(r)}),a&&n.length&&a(n)}),this}return r.pastezone=n}),e("skylark-utils-filer/select",["./filer"],function(e){function t(e){function t(e){for(var t=e.length;t--;)e[t].size>n&&e.splice(t,1);o(e)}e=e||{};var a=e.directory||!1,i=e.multiple||!1,o=e.picked;if(!r){var l=r=document.createElement("input");l.type="file",l.style.position="fixed",nput.style.left=0,l.style.top=0,l.style.opacity=.001,document.body.appendChild(l),l.onchange=function(e){var r=e.target.webkitEntries||e.target.entries;r&&r.length?webentry.all(r).then(function(e){t(e)}):t(Array.prototype.slice.call(e.target.files)),l.value=""}}r.multiple=i,r.webkitdirectory=a,r.click()}var r,n=1/0;return e.select=t}),e("skylark-utils-filer/picker",["skylark-langx/objects","skylark-utils-dom/eventer","./filer","./select"],function(e,t,r,n){function a(e,r){return t.on(e,"click",function(e){e.preventDefault(),n(r)}),this}return r.picker=a}),e("skylark-utils-filer/read",["skylark-langx/Deferred","./filer"],function(e,t){function r(t,r){r=r||{};var n=new e,a=new FileReader;return a.onload=function(e){n.resolve(e.target.result)},a.onerror=function(e){var t=e.target.error.code;2===t?alert("please don't open this page using protocol fill:///"):alert("error code: "+t)},r.asArrayBuffer?a.readAsArrayBuffer(t):r.asDataUrl?a.readAsDataURL(t):r.asText?a.readAsText(t):a.readAsArrayBuffer(t),n.promise}return t.read=t.readFile=r}),e("skylark-utils-filer/upload",["skylark-langx/types","skylark-langx/objects","skylark-langx/arrays","skylark-langx/Xhr","./filer"],function(e,t,r,n,a){function i(r){function a(e){e.type=e.type||"POST",s(e,!0)||e.data||i(e)}function i(r){var n,a=r.files[0],i=r.multipart,o="array"===e.type(r.paramName)?r.paramName[0]:r.paramName;r.headers=t.mixin({},r.headers),r.contentRange&&(r.headers["Content-Range"]=r.contentRange),i?(n=new FormData,r.blob?n.append(o,r.blob,a.name):t.each(r.files,function(t,a){n.append("array"===e.type(r.paramName)&&r.paramName[t]||o,a,a.uploadName||a.name)}),r.data=n):(r.headers["Content-Disposition"]='attachment; filename="'+encodeURI(a.name)+'"',r.contentType=a.type||"application/octet-stream",r.data=r.blob||a),r.blob=null}function o(e){var t=e.getResponseHeader("Range"),r=t&&t.split("-"),n=r&&r.length>1&&parseInt(r[1],10);return n&&n+1}function l(){this.timestamp=Date.now?Date.now():(new Date).getTime(),this.loaded=0,this.bitrate=0,this.getBitrate=function(e,t,r){var n=e-this.timestamp;return(!this.bitrate||!r||n>r)&&(this.bitrate=(t-this.loaded)*(1e3/n)*8,this.loaded=t,this.timestamp=e),this.bitrate}}function s(e,r){e.uploadedBytes=e.uploadedBytes||0;var n,a,l=e.files[0],s=l.size,u=e.uploadedBytes,f=e.maxChunkSize||s,p=d,c=new Deferred,y=c.promise;return!(!p||!(u||f<s)||e.data)&&(!!r||(u>=s?(l.error=e.i18n("uploadedBytes"),this._getXHRPromise(!1,e.context,[null,"error",l.error])):(a=function(){var r=t.mixin({},e),d=r._progress.loaded;r.blob=p.call(l,u,u+f,l.type),r.chunkSize=r.blob.size,r.contentRange="bytes "+u+"-"+(u+r.chunkSize-1)+"/"+s,i(r),n=$.ajax(r).done(function(t,n,i){u=o(i)||u+r.chunkSize,d+r.chunkSize-r._progress.loaded&&c.progress({lengthComputable:!0,loaded:u-r.uploadedBytes,total:u-r.uploadedBytes}),e.uploadedBytes=r.uploadedBytes=u,r.result=t,r.textStatus=n,r.jqXHR=i,u<s?a():c.resolveWith(r.context,[t,n,i])}).fail(function(e,t,n){r.jqXHR=e,r.textStatus=t,r.errorThrown=n,c.rejectWith(r.context,[e,t,n])})},y.abort=function(){return n.abort()},a(),y)))}var u=t.mixin({contentRange:null,paramName:void 0,singleFileUploads:!0,limitMultiFileUploads:void 0,limitMultiFileUploadSize:void 0,limitMultiFileUploadSizeOverhead:512,sequentialUploads:!1,limitConcurrentUploads:void 0,multipart:!0,maxChunkSize:void 0,uploadedBytes:void 0,recalculateProgress:!0,progressInterval:100,bitrateInterval:500,autoUpload:!0,messages:{uploadedBytes:"Uploaded bytes exceed file size"},i18n:function(e,r){return e=this.messages[e]||e.toString(),r&&t.each(r,function(t,r){e=e.replace("{"+t+"}",r)}),e},formData:function(e){return e.serializeArray()},add:function(e,t){return!e.isDefaultPrevented()&&void((t.autoUpload||t.autoUpload!==!1&&$(this).fileupload("option","autoUpload"))&&t.process().done(function(){t.submit()}))},processData:!1,contentType:!1,cache:!1},r),d=function(){var e=Blob.prototype.slice||Blob.prototype.webkitSlice||Blob.prototype.mozSlice;return e.apply(this,arguments)},f=function(e){return n.request(e.url,e)};a(u),u._bitrateTimer=new l;var p=s(u)||f(u);return p.options=u,p}return a.upload=i}),e("skylark-utils-filer/main",["./filer","./download","./dropzone","./pastezone","./picker","./read","./select","./upload","./webentry"],function(e){return e}),e("skylark-utils-filer",["skylark-utils-filer/main"],function(e){return e})},this);
//# sourceMappingURL=sourcemaps/skylark-utils-filer.js.map
